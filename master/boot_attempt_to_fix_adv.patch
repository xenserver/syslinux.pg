fix attempt to fix ADV in adv.inc

From: Frediano Ziglio <frediano.ziglio@citrix.com>

diff --git a/core/adv.inc b/core/adv.inc
index 0b45a6c..4750cea 100644
--- a/core/adv.inc
+++ b/core/adv.inc
@@ -357,12 +357,12 @@ adv_read_write:
 		mov eax,[ADVSec0]
 		mov edx,[ADVSec0+4]
 		mov bx,adv0
-		call .doone
+;		call .doone
 
 		mov eax,[ADVSec1]
 		mov edx,[ADVSec1+4]
 		mov bx,adv1
-		call .doone
+;		call .doone
 
 		popad
 		ret
@@ -375,14 +375,36 @@ adv_read_write:
 		mov cx,adv_retries
 .eb_retry:
 		; Form DAPA on stack
+		cld
+
+		pushad
+
+		; copy to sector
+		push ax
+		push ds
+		push es
+		mov si, bx
+		xor di, di
+		push es
+		pop ds
+		push 2000h
+		pop es
+		mov cx, 256
+		rep movsw
+		mov cx, 256 * 7
+		xor ax, ax
+		rep stosw
+		pop es
+		pop ds
+		pop ax
+
 		push edx
 		push eax
-		push es
-		push bx
+		push 2000h
+		push 0
 		push word 1			; Sector count
 		push word 16			; DAPA size
 		mov si,sp
-		pushad
 		mov dl,[ADVDrive]
 		mov ax,4000h
 		or ah,[ADVOp]
@@ -391,9 +413,24 @@ adv_read_write:
 		pop ds
 		int 13h
 		pop ds
-		popad
 		lea sp,[si+16]			; Remove DAPA
+
+		popad
 		jc .eb_error
+
+		; copy it back
+		pusha
+		push ds
+		mov di, bx
+		xor si, si
+		push 2000h
+		pop ds
+		mov cx, 256
+		rep movsw
+		pop ds
+		popa
+
+
 		pop si
 		ret
 .eb_error:
